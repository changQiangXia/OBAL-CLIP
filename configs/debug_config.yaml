# Debug Configuration for RTX 3050Ti (4GB VRAM)
# 用于本地开发和流程验证

experiment_name: "the_architect_debug"
seed: 42
debug: true

# Model Configuration
model:
  name: "the_architect"
  clip_model: "ViT-B-32"  # OpenAI CLIP ViT-B/32
  clip_pretrained: "openai"
  
  # Object Detector
  detector:
    type: "yolov8"  # 轻量级检测器，适合低显存
    model_name: "yolov8n.pt"  # nano 版本
    conf_threshold: 0.3
    max_detections: 10
    device: "cpu"  # 检测器放在 CPU 上节省显存
  
  # Object-Aware Adapter
  adapter:
    hidden_dim: 256
    num_heads: 4
    num_layers: 2
    dropout: 0.1
    use_lora: true
    lora_rank: 8
    freeze_clip: true  # 冻结 CLIP，只训练 Adapter

# Training Configuration
training:
  num_epochs: 5  # Debug 模式只跑 5 个 epoch
  batch_size: 32  # 小 batch size 适应 4GB 显存
  gradient_accumulation_steps: 8  # 有效 batch size = 32
  
  optimizer:
    type: "adamw"
    lr: 1.0e-4
    weight_decay: 0.01
    betas: [0.9, 0.999]
  
  scheduler:
    type: "cosine"
    warmup_steps: 100
    min_lr: 1.0e-6
  
  # Mixed Precision
  amp: true  # 自动混合精度
  
  # Gradient Clipping
  clip_grad_norm: 1.0
  
  # Checkpointing
  save_every: 2
  eval_every: 1
  keep_last_n: 3

# Loss Configuration
loss:
  contrastive_weight: 1.0
  structural_weight: 0.5
  temperature: 0.07
  hard_negative_ratio: 0.5  # Debug 模式使用较少的硬负样本
  
# Data Configuration
data:
  # 使用合成数据或极小数据集
  use_synthetic: true
  synthetic_samples: 100
  
  # 图像尺寸
  image_size: 224
  
  # DataLoader
  num_workers: 0  # Debug 模式使用 0 workers
  pin_memory: false
  
  # 数据增强
  augmentation:
    random_crop: true
    random_flip: true
    color_jitter: 0.1

# Visualization Configuration
visualization:
  enabled: true
  plot_every: 50  # 每 50 个 step 更新一次
  save_attention_maps: true
  save_qualitative: true
  num_qualitative_samples: 6

# Logging
logging:
  level: "INFO"
  use_tensorboard: true
  use_wandb: false  # Debug 模式关闭 wandb
  log_every: 10

# Device
# 自动检测: cuda 如果可用，否则 cpu
device: "auto"
